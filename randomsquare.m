function [X,F,D,A,sfpts] = randomsquare
%Generates a tensor of random values, with drift in the first and second
%retention modes. %Let's analyze it in the same function.

%settings
numMSp = 20;
numFac = 4;
mzs = 761;
jitter1 = 1.5;
jitter2 = 25;
mods = 20;
scans = 200;
peakstd1 = 0.75;
peakstd2 = 20;
smpls = 8;
SNR = 500;

A = zeros(mzs,numFac);

for aa = 1:numFac
    
    for pp = 1:numMSp
        A(:,aa) = A(:,aa) +  rand(1,1).*normpdf(1:1:761,761*rand(1,1),0.5)';
    end
    
    %A(:,aa) = A(:,aa) + 0.001.*randn(mzs,1);
    
    A(:,aa) = A(:,aa)./norm(A(:,aa));
end


%A = rand(mzs,numFac);

%A(A==0) = 1e-8;

%A = [3.34956422270321e-13,0.00181466102512378;0.0292784508589324,7.03047144008789e-14;0.00582890946700019,0.00438573343619760;3.34956422270321e-13,0.0965631824664654;3.34956422270321e-13,0.0340571783280147;3.34956422270321e-13,0.241492026718939;3.34956422270321e-13,0.0162447627085404;0.110557187761700,7.03047144008789e-14;0.00588069445576491,7.03047144008789e-14;0.00460624760715352,7.03047144008789e-14;3.34956422270321e-13,0.00903855427435897;3.34956422270321e-13,0.0109202769105838;3.34956422270321e-13,0.00578163858625827;3.34956422270321e-13,0.0123571024401645;0.00781232711532755,7.03047144008789e-14;0.329177671739482,7.03047144008789e-14;0.0454889806224073,7.03047144008789e-14;3.34956422270321e-13,0.0112427413831405;0.0302901918440208,0.00231887724929331;3.34956422270321e-13,0.0325590220674989;0.0177385738578963,7.03047144008789e-14;0.0718068730030759,7.03047144008789e-14;3.34956422270321e-13,0.00448665639988144;3.34956422270321e-13,0.0191663948070172;3.34956422270321e-13,0.0185307947639598;3.34956422270321e-13,0.0229954248315337;3.34956422270321e-13,0.00701234617213219;0.0267009439591539,7.03047144008789e-14;0.00752957906540740,7.03047144008789e-14;0.0474390557150753,7.03047144008789e-14;3.34956422270321e-13,0.00451294290528693;3.34956422270321e-13,0.00654516935992282;0.0180793200623450,0.00569905232919534;3.34956422270321e-13,0.867917391242020;3.34956422270321e-13,0.0818306909609393;0.666292259134708,7.03047144008789e-14;0.0491232899171486,7.03047144008789e-14;3.34956422270321e-13,0.0263638068233424;3.34956422270321e-13,0.00546246979313898;3.34956422270321e-13,0.00815329089942934;3.34956422270321e-13,0.00164844705439605;0.00180034126948459,0.00261594679459069;0.00825388190217379,7.03047144008789e-14;0.163161914800111,7.03047144008789e-14;0.0111330237744537,7.03047144008789e-14;3.34956422270321e-13,0.0127916174743359;0.0232574954610069,7.03047144008789e-14;3.34956422270321e-13,0.00550108684459761;0.00596824024727068,7.03047144008789e-14;3.34956422270321e-13,0.0215715358267861;3.34956422270321e-13,0.0127437183879246;3.34956422270321e-13,0.108450956677319;3.34956422270321e-13,0.0288305715843621;3.34956422270321e-13,0.00766102925159361;3.34956422270321e-13,0.00116851835028657;3.34956422270321e-13,0.00763657110933807;3.34956422270321e-13,0.00258264196873856;3.34956422270321e-13,0.00378427284924511;0.00306507497713913,0.000175984881742574;0.0327790618510100,7.03047144008789e-14;0.00528599247700898,7.03047144008789e-14;0.0133009708186870,7.03047144008789e-14;3.34956422270321e-13,0.00279976461762463;3.34956422270321e-13,0.0153511511822506;3.34956422270321e-13,0.00533311872930891;3.34956422270321e-13,0.0224510178989895;3.34956422270321e-13,0.00350240582388080;3.34956422270321e-13,0.00481562144880665;3.34956422270321e-13,0.00156454204714340;3.34956422270321e-13,0.00288088496528951;0.00428308948229340,7.03047144008789e-14;0.502197075606716,7.03047144008789e-14;0.0360160711143653,7.03047144008789e-14;0.0112594693820662,7.03047144008789e-14;0.00107065462126777,0.000328771411441063;3.34956422270321e-13,0.0191416148436563;0.0266204140645047,7.03047144008789e-14;0.101300595269501,7.03047144008789e-14;0.00843561200589533,0.00120590753081043;3.34956422270321e-13,0.0115141004582517;3.34956422270321e-13,0.00865155819924587;3.34956422270321e-13,0.0102494474181833;3.34956422270321e-13,0.00181452950198781;3.34956422270321e-13,0.00474612993420353;3.34956422270321e-13,0.000949736396353089;0.000967237214587596,0.000534258851766359;3.34956422270321e-13,0.0124021755561410;3.34956422270321e-13,0.00198947959327365;0.00261104577455775,7.03047144008789e-14;0.0867009718342078,7.03047144008789e-14;0.0259863590522716,7.03047144008789e-14;3.34956422270321e-13,0.0118560700740865;0.00952685935253119,7.03047144008789e-14;3.34956422270321e-13,0.0432497422926741;3.34956422270321e-13,0.00829102589728449;3.34956422270321e-13,0.147511342258517;3.34956422270321e-13,0.0213332823126235;3.34956422270321e-13,0.0124861491505134;3.34956422270321e-13,0.00163789230091151;3.34956422270321e-13,0.000793577616553384;0.00125780541720696,4.34953888943128e-05;0.186033924259836,7.03047144008789e-14;0.0281881739886410,7.03047144008789e-14;0.0172266403616420,7.03047144008789e-14;0.00298378525556974,7.03047144008789e-14;3.34956422270321e-13,0.00365027420774800;0.00192678968511679,0.000481957435245896;0.220874055378314,7.03047144008789e-14;0.0356355948647313,7.03047144008789e-14;3.34956422270321e-13,0.0895218827520089;3.34956422270321e-13,0.0168002999247483;3.34956422270321e-13,0.0264769607561737;3.34956422270321e-13,0.00385448655715554;3.34956422270321e-13,0.00384336886042714;3.34956422270321e-13,0.000789706160555466;0.00437916380421996,7.03047144008789e-14;0.00517624239743700,7.03047144008789e-14;0.0249515842526541,7.03047144008789e-14;0.00706336603950646,7.03047144008789e-14;0.0647919700449422,7.03047144008789e-14;0.00876012514225566,7.03047144008789e-14;3.34956422270321e-13,0.00350100483088922;3.34956422270321e-13,0.00138746134830282;3.34956422270321e-13,0.00478868999081428;3.34956422270321e-13,0.00167603640689462;3.34956422270321e-13,0.00390019765464587;3.34956422270321e-13,0.00258230086966002;3.34956422270321e-13,0.00124695379097442;3.34956422270321e-13,0.000597217529148268;3.34956422270321e-13,0.000550086936969765;3.34956422270321e-13,0.000461999724237532;0.00422108527872823,7.03047144008789e-14;0.103932560106661,7.03047144008789e-14;0.0179789506856771,7.03047144008789e-14;0.00575495842560976,7.03047144008789e-14;3.34956422270321e-13,0.0188889474421599;3.34956422270321e-13,0.00840140901610783;3.34956422270321e-13,0.0110853835904858;3.34956422270321e-13,0.00244397336844408;3.34956422270321e-13,0.0259397887451994;3.34956422270321e-13,0.00427119000818453;3.34956422270321e-13,0.0141250936114797;3.34956422270321e-13,0.00312457982764907;3.34956422270321e-13,0.00171866889762228;3.34956422270321e-13,0.000805132004154656;0.0903445280155406,7.03047144008789e-14;0.0136314318112583,7.03047144008789e-14;0.00490211121888752,7.03047144008789e-14;3.34956422270321e-13,0.000511332513158341;3.34956422270321e-13,0.000947823257754006;3.34956422270321e-13,0.000635976038998695;3.34956422270321e-13,0.00310983738610305;3.34956422270321e-13,0.00223966568404093;3.34956422270321e-13,0.0457102432443243;3.34956422270321e-13,0.0179098796801311;3.34956422270321e-13,0.00849908917590393;3.34956422270321e-13,0.00196020512791740;3.34956422270321e-13,0.000989204276175635;3.34956422270321e-13,0.000510396414068301;0.00159802439337310,7.03047144008789e-14;0.0124201371312900,7.03047144008789e-14;0.00799177136820235,7.03047144008789e-14;0.00192029114829359,7.03047144008789e-14;0.00332833725911694,7.03047144008789e-14;0.0259025066079285,7.03047144008789e-14;0.00588909796257296,7.03047144008789e-14;0.00272360968985475,7.03047144008789e-14;3.34956422270321e-13,0.00274262030400267;3.34956422270321e-13,0.00487031096254098;3.34956422270321e-13,0.0788342638728518;3.34956422270321e-13,0.0194671123077481;3.34956422270321e-13,0.0108992330741340;3.34956422270321e-13,0.00218866287101683;3.34956422270321e-13,0.000824013280570957;3.34956422270321e-13,0.000432550163059488;0.00637389023815780,7.03047144008789e-14;0.00182244647218769,7.03047144008789e-14;0.0296781358514907,7.03047144008789e-14;0.00793512257320459,7.03047144008789e-14;0.00350036169118348,7.03047144008789e-14;3.34956422270321e-13,0.000556568727342661;3.34956422270321e-13,0.00315775809269053;3.34956422270321e-13,0.00115409899482770;3.34956422270321e-13,0.00693677156766203;3.34956422270321e-13,0.00168800535572757;3.34956422270321e-13,0.00391915287474922;3.34956422270321e-13,0.00137462178982809;3.34956422270321e-13,0.000878803757570848;3.34956422270321e-13,0.000615476096453832;0.00182375738082845,7.03047144008789e-14;3.34956422270321e-13,0.000557523962852532;0.00782798032589252,7.03047144008789e-14;0.00223122801810832,7.03047144008789e-14;3.34956422270321e-13,0.0140277799876923;3.34956422270321e-13,0.00464152270290113;3.34956422270321e-13,0.00274899734387488;3.34956422270321e-13,0.00104950818391462;3.34956422270321e-13,0.000888094039953262;3.34956422270321e-13,0.000620614661890003;3.34956422270321e-13,0.000547484031598919;3.34956422270321e-13,0.000501557827437859;3.34956422270321e-13,0.000450956366990841;3.34956422270321e-13,0.000440833754338343;3.34956422270321e-13,0.000426054208044831;3.34956422270321e-13,0.000427282321186469;0.00113762241195056,6.33804236735534e-05;3.34956422270321e-13,0.000442178689024526;0.00539246891598727,7.03047144008789e-14;0.00197048544943210,7.03047144008789e-14;3.34956422270321e-13,0.0166905347457075;3.34956422270321e-13,0.00794005381915231;3.34956422270321e-13,0.00513834394249187;3.34956422270321e-13,0.00158466573899550;3.34956422270321e-13,0.000854345289643199;3.34956422270321e-13,0.000465622754025771;3.34956422270321e-13,0.000418976754106153;3.34956422270321e-13,0.000610058883459116;3.34956422270321e-13,0.000658386578363144;3.34956422270321e-13,0.000705699115064710;3.34956422270321e-13,0.000684394479905101;3.34956422270321e-13,0.000684901250982665;3.34956422270321e-13,0.000697902286113120;3.34956422270321e-13,0.000702943356779924;3.34956422270321e-13,0.000657752101123512;3.34956422270321e-13,0.000623618790480962;3.34956422270321e-13,0.00528990972308178;3.34956422270321e-13,0.00336422380202017;3.34956422270321e-13,0.315477355294291;3.34956422270321e-13,0.0784944875837200;3.34956422270321e-13,0.0337204236480030;3.34956422270321e-13,0.00558200539954657;3.34956422270321e-13,0.00118075787874270;3.34956422270321e-13,0.000358902008047245;0.000547354405385004,9.06507071286192e-05;0.000126428303392599,0.000237826009589101;0.0764227857915975,7.03047144008789e-14;0.0177375609410012,7.03047144008789e-14;0.00808267650361246,7.03047144008789e-14;0.00156609627059314,7.03047144008789e-14;3.34956422270321e-13,0.000332145149924654;3.34956422270321e-13,0.000308361946255484;3.34956422270321e-13,0.000762943664590876;3.34956422270321e-13,0.000576332378284078;3.34956422270321e-13,0.000403168413482615;3.34956422270321e-13,0.000330124942263265;3.34956422270321e-13,0.000310207760213841;3.34956422270321e-13,0.000314546425234823;3.34956422270321e-13,0.000309970676397552;3.34956422270321e-13,0.000317439550699473;3.34956422270321e-13,0.000317755880047548;0.00130798432267610,7.03047144008789e-14;0.000160717852469470,0.000268856063851156;3.34956422270321e-13,0.000318987405490844;3.34956422270321e-13,0.000322426560194028;3.34956422270321e-13,0.000311241088636115;3.34956422270321e-13,0.000308812061790493;3.34956422270321e-13,0.000304202953608470;3.34956422270321e-13,0.000304025249955519;3.34956422270321e-13,0.000299309696169073;3.34956422270321e-13,0.000300875488586047;3.34956422270321e-13,0.000300105813028866;3.34956422270321e-13,0.000303420409538287;3.34956422270321e-13,0.000310712031873474;3.34956422270321e-13,0.000311736369019194;3.34956422270321e-13,0.000308570952624050;3.34956422270321e-13,0.000305960476311128;3.34956422270321e-13,0.000310568115476329;3.34956422270321e-13,0.000308193508039065;3.34956422270321e-13,0.000305262435025957;3.34956422270321e-13,0.000305570068300507;3.34956422270321e-13,0.000299766893929742;3.34956422270321e-13,0.000302009213897574;3.34956422270321e-13,0.000303667250753576;3.34956422270321e-13,0.000304786055767192;3.34956422270321e-13,0.000302989551139256;3.34956422270321e-13,0.000303994695665758;3.34956422270321e-13,0.000307521591140746;3.34956422270321e-13,0.000309940822670976;3.34956422270321e-13,0.000315480220609034;3.34956422270321e-13,0.000320693504628225;3.34956422270321e-13,0.000312869990924338;3.34956422270321e-13,0.000311269975099806;3.34956422270321e-13,0.000310803947627353;3.34956422270321e-13,0.000310865750487859;3.34956422270321e-13,0.000310747447532217;3.34956422270321e-13,0.000307346162978130;3.34956422270321e-13,0.000308739977945615;3.34956422270321e-13,0.000308179895499744;3.34956422270321e-13,0.000305309276214506;3.34956422270321e-13,0.000315133344068354;3.34956422270321e-13,0.000314677556600042;3.34956422270321e-13,0.000314695314189291;3.34956422270321e-13,0.000316456053786521;3.34956422270321e-13,0.000316984094375830;3.34956422270321e-13,0.000315113174625839;3.34956422270321e-13,0.000314445815556114;3.34956422270321e-13,0.000311790486526163;3.34956422270321e-13,0.000309103902203637;3.34956422270321e-13,0.000306921228379520;3.34956422270321e-13,0.000307109560029673;3.34956422270321e-13,0.000310345462696831;3.34956422270321e-13,0.000317646391966814;3.34956422270321e-13,0.000311640381825632;3.34956422270321e-13,0.000313498608012028;3.34956422270321e-13,0.000309034184177179;3.34956422270321e-13,0.000310789562369905;3.34956422270321e-13,0.000315559019964672;3.34956422270321e-13,0.000315663526206918;3.34956422270321e-13,0.000318215260554187;3.34956422270321e-13,0.000316016136336739;3.34956422270321e-13,0.000312551045026008;3.34956422270321e-13,0.000311287718464355;3.34956422270321e-13,0.000308508848675897;3.34956422270321e-13,0.000312385926796208;3.34956422270321e-13,0.000311788312365444;3.34956422270321e-13,0.000325491856240595;3.34956422270321e-13,0.000313673049382508;3.34956422270321e-13,0.000312227314369927;3.34956422270321e-13,0.000312598099947947;3.34956422270321e-13,0.000312508778702294;3.34956422270321e-13,0.000312532880071800;3.34956422270321e-13,0.000315298642404183;3.34956422270321e-13,0.000312170199234577;3.34956422270321e-13,0.000314703459985643;3.34956422270321e-13,0.000315094840340349;3.34956422270321e-13,0.000313682704900550;3.34956422270321e-13,0.000315291980556704;3.34956422270321e-13,0.000311301384920566;3.34956422270321e-13,0.000312174986151587;3.34956422270321e-13,0.000313280914938378;3.34956422270321e-13,0.000312176661108560;3.34956422270321e-13,0.000313557323255157;3.34956422270321e-13,0.000313934483750318;3.34956422270321e-13,0.000315764817424057;3.34956422270321e-13,0.000317316741012763;3.34956422270321e-13,0.000314006366258022;3.34956422270321e-13,0.000314040257711692;3.34956422270321e-13,0.000312554308158657;3.34956422270321e-13,0.000312936609934407;3.34956422270321e-13,0.000314004237879312;3.34956422270321e-13,0.000315447841820046;3.34956422270321e-13,0.000318678256926870;3.34956422270321e-13,0.000319293343193393;3.34956422270321e-13,0.000316922141702057;3.34956422270321e-13,0.000316520358019953;3.34956422270321e-13,0.000315179187923474;3.34956422270321e-13,0.000313095368823363;3.34956422270321e-13,0.000314125768769041;3.34956422270321e-13,0.000312968848150373;3.34956422270321e-13,0.000309522665758636;3.34956422270321e-13,0.000311987916206709;3.34956422270321e-13,0.000312084147904833;3.34956422270321e-13,0.000311794309090909;3.34956422270321e-13,0.000311859443058944;3.34956422270321e-13,0.000315696671407885;3.34956422270321e-13,0.000319116982349151;3.34956422270321e-13,0.000318361449829252;3.34956422270321e-13,0.000315548992448277;3.34956422270321e-13,0.000317020940524119;3.34956422270321e-13,0.000317571395415671;3.34956422270321e-13,0.000318280402666568;3.34956422270321e-13,0.000317144755800388;3.34956422270321e-13,0.000315917834731461;3.34956422270321e-13,0.000314717769196101;3.34956422270321e-13,0.000312652486853920;3.34956422270321e-13,0.000312369256261239;3.34956422270321e-13,0.000311531266413452;3.34956422270321e-13,0.000310875514127297;3.34956422270321e-13,0.000309723892921155;3.34956422270321e-13,0.000312235137484545;3.34956422270321e-13,0.000312600151587756;3.34956422270321e-13,0.000317069513947563;3.34956422270321e-13,0.000317622670901440;3.34956422270321e-13,0.000317430118376729;3.34956422270321e-13,0.000315713025117434;3.34956422270321e-13,0.000316746670976371;3.34956422270321e-13,0.000315744340463730;3.34956422270321e-13,0.000318183747148254;3.34956422270321e-13,0.000312365201796868;3.34956422270321e-13,0.000310018881618394;3.34956422270321e-13,0.000312795400130042;3.34956422270321e-13,0.000311337660221587;3.34956422270321e-13,0.000313996246208200;3.34956422270321e-13,0.000316069883306461;3.34956422270321e-13,0.000313940645587348;3.34956422270321e-13,0.000313627659860840;3.34956422270321e-13,0.000314806848764306;3.34956422270321e-13,0.000315369031815491;3.34956422270321e-13,0.000313978888360961;3.34956422270321e-13,0.000315577249847623;3.34956422270321e-13,0.000315181262200236;3.34956422270321e-13,0.000313775166070041;3.34956422270321e-13,0.000316113397824189;3.34956422270321e-13,0.000314523427807853;3.34956422270321e-13,0.000313861303919783;3.34956422270321e-13,0.000314176337974613;3.34956422270321e-13,0.000316113245246677;3.34956422270321e-13,0.000314609316967030;3.34956422270321e-13,0.000315708370328552;3.34956422270321e-13,0.000315691757198236;3.34956422270321e-13,0.000316326681833149;3.34956422270321e-13,0.000316763053258450;3.34956422270321e-13,0.000316489420385221;3.34956422270321e-13,0.000316585864906363;3.34956422270321e-13,0.000315553786578111;3.34956422270321e-13,0.000314717202938382;3.34956422270321e-13,0.000313354244945940;3.34956422270321e-13,0.000312807337140361;3.34956422270321e-13,0.000311133228209227;3.34956422270321e-13,0.000312757243542837;3.34956422270321e-13,0.000315300615219323;3.34956422270321e-13,0.000315502010092604;3.34956422270321e-13,0.000317375493716134;3.34956422270321e-13,0.000315199912247031;3.34956422270321e-13,0.000315584040171838;3.34956422270321e-13,0.000311890728681251;3.34956422270321e-13,0.000317053767663229;3.34956422270321e-13,0.000315981572764218;3.34956422270321e-13,0.000314510204478791;3.34956422270321e-13,0.000316362294079127;3.34956422270321e-13,0.000315971835771605;3.34956422270321e-13,0.000315880947883839;3.34956422270321e-13,0.000316982879895678;3.34956422270321e-13,0.000316237682930071;3.34956422270321e-13,0.000317057540989713;3.34956422270321e-13,0.000314303073602882;3.34956422270321e-13,0.000314880229506476;3.34956422270321e-13,0.000314007079923911;3.34956422270321e-13,0.000313071679329801;3.34956422270321e-13,0.000314363072711041;3.34956422270321e-13,0.000313443290458657;3.34956422270321e-13,0.000314826016694358;3.34956422270321e-13,0.000314541653323171;3.34956422270321e-13,0.000314124681136600;3.34956422270321e-13,0.000317147935210343;3.34956422270321e-13,0.000316700720313548;3.34956422270321e-13,0.000319174466836080;3.34956422270321e-13,0.000317956654124017;3.34956422270321e-13,0.000316979808346158;3.34956422270321e-13,0.000316245437230574;3.34956422270321e-13,0.000315463427273837;3.34956422270321e-13,0.000312785336016058;3.34956422270321e-13,0.000314444717677274;3.34956422270321e-13,0.000312455221394151;3.34956422270321e-13,0.000315307732463859;3.34956422270321e-13,0.000315411886805320;3.34956422270321e-13,0.000314105574768359;3.34956422270321e-13,0.000311965626478302;3.34956422270321e-13,0.000314764320680987;3.34956422270321e-13,0.000316063229318049;3.34956422270321e-13,0.000317153386248527;3.34956422270321e-13,0.000319596035599156;3.34956422270321e-13,0.000318246351200662;3.34956422270321e-13,0.000316589890544417;3.34956422270321e-13,0.000313730346256386;3.34956422270321e-13,0.000313822722710304;3.34956422270321e-13,0.000314171451306984;3.34956422270321e-13,0.000313272868655608;3.34956422270321e-13,0.000314302125295917;3.34956422270321e-13,0.000313504554169646;3.34956422270321e-13,0.000313130382661141;3.34956422270321e-13,0.000310314199821897;3.34956422270321e-13,0.000312428134635048;3.34956422270321e-13,0.000314314507133831;3.34956422270321e-13,0.000316945374145362;3.34956422270321e-13,0.000318064160653061;3.34956422270321e-13,0.000319510617485861;3.34956422270321e-13,0.000318768020123176;3.34956422270321e-13,0.000317656839525061;3.34956422270321e-13,0.000316711750557309;3.34956422270321e-13,0.000317127012506124;3.34956422270321e-13,0.000315477763786894;3.34956422270321e-13,0.000314489875171151;3.34956422270321e-13,0.000314722859541056;3.34956422270321e-13,0.000313412512271097;3.34956422270321e-13,0.000312708276247746;3.34956422270321e-13,0.000314767840139952;3.34956422270321e-13,0.000314506706923737;3.34956422270321e-13,0.000315102578345097;3.34956422270321e-13,0.000314951422666237;3.34956422270321e-13,0.000316593108774683;3.34956422270321e-13,0.000314658849434110;3.34956422270321e-13,0.000315654246270951;3.34956422270321e-13,0.000317504530012256;3.34956422270321e-13,0.000316824885727614;3.34956422270321e-13,0.000315308471016733;3.34956422270321e-13,0.000317262284926733;3.34956422270321e-13,0.000316429597071799;3.34956422270321e-13,0.000317060247435323;3.34956422270321e-13,0.000316708798395084;3.34956422270321e-13,0.000315952808055437;3.34956422270321e-13,0.000317198144068815;3.34956422270321e-13,0.000312629319653252;3.34956422270321e-13,0.000316037220975149;3.34956422270321e-13,0.000316516403615725;3.34956422270321e-13,0.000316934642985439;3.34956422270321e-13,0.000314817309672299;3.34956422270321e-13,0.000317588575588655;3.34956422270321e-13,0.000318504825809760;3.34956422270321e-13,0.000318864240355175;3.34956422270321e-13,0.000321570607717425;3.34956422270321e-13,0.000317971569176153;3.34956422270321e-13,0.000316740600976298;3.34956422270321e-13,0.000318271036396340;3.34956422270321e-13,0.000316586924674145;3.34956422270321e-13,0.000314978078826749;3.34956422270321e-13,0.000316203200236485;3.34956422270321e-13,0.000319551699096892;3.34956422270321e-13,0.000321789588377649;3.34956422270321e-13,0.000317843977407290;3.34956422270321e-13,0.000318383010169040;3.34956422270321e-13,0.000318724624461352;3.34956422270321e-13,0.000316873567112039;3.34956422270321e-13,0.000315279717345500;3.34956422270321e-13,0.000313850666537324;3.34956422270321e-13,0.000316473312907167;3.34956422270321e-13,0.000317482087457456;3.34956422270321e-13,0.000317741437257453;3.34956422270321e-13,0.000317606338316295;3.34956422270321e-13,0.000317903119558653;3.34956422270321e-13,0.000317373112508318;3.34956422270321e-13,0.000319077708822750;3.34956422270321e-13,0.000315675288274963;3.34956422270321e-13,0.000315364027396517;3.34956422270321e-13,0.000314072939520802;3.34956422270321e-13,0.000314508885322016;3.34956422270321e-13,0.000316912363410298;3.34956422270321e-13,0.000315781676062415;3.34956422270321e-13,0.000315156950082042;3.34956422270321e-13,0.000315445943187526;3.34956422270321e-13,0.000315949228910250;3.34956422270321e-13,0.000317285648446190;3.34956422270321e-13,0.000319679965847327;3.34956422270321e-13,0.000318001455937630;3.34956422270321e-13,0.000317594827557959;3.34956422270321e-13,0.000318334438147034;3.34956422270321e-13,0.000317807449146972;3.34956422270321e-13,0.000317217444090349;3.34956422270321e-13,0.000318105102054351;3.34956422270321e-13,0.000318167030759261;3.34956422270321e-13,0.000316489401657051;3.34956422270321e-13,0.000315076113197066;3.34956422270321e-13,0.000314255124707537;3.34956422270321e-13,0.000314290909814513;3.34956422270321e-13,0.000315523292169327;3.34956422270321e-13,0.000314943720411545;3.34956422270321e-13,0.000315168317987526;3.34956422270321e-13,0.000315060486357812;3.34956422270321e-13,0.000317663700092489;3.34956422270321e-13,0.000319011339707281;3.34956422270321e-13,0.000321036442548475;3.34956422270321e-13,0.000322280345393128;3.34956422270321e-13,0.000321715412261640;3.34956422270321e-13,0.000319074732958670;3.34956422270321e-13,0.000319286507414288;3.34956422270321e-13,0.000318718779251786;3.34956422270321e-13,0.000316628196286238;3.34956422270321e-13,0.000314370320221151;3.34956422270321e-13,0.000317100406598562;3.34956422270321e-13,0.000315644199544536;3.34956422270321e-13,0.000316509445978561;3.34956422270321e-13,0.000316793728073177;3.34956422270321e-13,0.000317765392119449;3.34956422270321e-13,0.000316347172011693;3.34956422270321e-13,0.000318012202168304;3.34956422270321e-13,0.000319699327269649;3.34956422270321e-13,0.000320571500448656;3.34956422270321e-13,0.000318985688220485;3.34956422270321e-13,0.000316119366321136;3.34956422270321e-13,0.000315014249823062;3.34956422270321e-13,0.000315048431793362;3.34956422270321e-13,0.000314527445649510;3.34956422270321e-13,0.000314379258578521;3.34956422270321e-13,0.000315295280084087;3.34956422270321e-13,0.000313224692754959;3.34956422270321e-13,0.000315088665590086;3.34956422270321e-13,0.000317096509947300;3.34956422270321e-13,0.000317377650455791;3.34956422270321e-13,0.000317218713318127;3.34956422270321e-13,0.000316723405112852;3.34956422270321e-13,0.000316215394681487;3.34956422270321e-13,0.000316880936731354;3.34956422270321e-13,0.000317224979271393;3.34956422270321e-13,0.000318551451182664;3.34956422270321e-13,0.000319788104460499;3.34956422270321e-13,0.000318143104274427;3.34956422270321e-13,0.000318528581347466;3.34956422270321e-13,0.000315741977492112;3.34956422270321e-13,0.000317752973488987;3.34956422270321e-13,0.000315727816794240;3.34956422270321e-13,0.000314806449197752;3.34956422270321e-13,0.000314462230747061;3.34956422270321e-13,0.000313866313948882;3.34956422270321e-13,0.000314678294754854;3.34956422270321e-13,0.000316675621943147;3.34956422270321e-13,0.000317107099282087;3.34956422270321e-13,0.000318123884786634;3.34956422270321e-13,0.000318153725606556;3.34956422270321e-13,0.000317778693169416;3.34956422270321e-13,0.000316001958516829;3.34956422270321e-13,0.000314949118342410;3.34956422270321e-13,0.000313064511845239;3.34956422270321e-13,0.000311951129435270;3.34956422270321e-13,0.000313474165422472;3.34956422270321e-13,0.000314356946216264;3.34956422270321e-13,0.000314740578509270;3.34956422270321e-13,0.000316617868164186;3.34956422270321e-13,0.000316501178268156;3.34956422270321e-13,0.000315753567504408;3.34956422270321e-13,0.000315210600843143;3.34956422270321e-13,0.000315537298526866;3.34956422270321e-13,0.000314200509285293;3.34956422270321e-13,0.000312992172074453;3.34956422270321e-13,0.000313393583826897;3.34956422270321e-13,0.000317185657427771;3.34956422270321e-13,0.000316565766511987;3.34956422270321e-13,0.000317897783883126;3.34956422270321e-13,0.000318648805465632;3.34956422270321e-13,0.000319028811849890;3.34956422270321e-13,0.000318878694928228;3.34956422270321e-13,0.000318565626625633;3.34956422270321e-13,0.000318269866758476;3.34956422270321e-13,0.000317177425074143;3.34956422270321e-13,0.000317331364416707;3.34956422270321e-13,0.000316522731926695;3.34956422270321e-13,0.000313839417802618;3.34956422270321e-13,0.000314041847745240;3.34956422270321e-13,0.000313940693394297;3.34956422270321e-13,0.000311853358065116;3.34956422270321e-13,0.000313731052324629;3.34956422270321e-13,0.000313467451496390;3.34956422270321e-13,0.000311260294601203;3.34956422270321e-13,0.000313658861818287;3.34956422270321e-13,0.000314408728958217;3.34956422270321e-13,0.000318042110439755;3.34956422270321e-13,0.000319184070192865;3.34956422270321e-13,0.000319870198892927;3.34956422270321e-13,0.000320866956745481;3.34956422270321e-13,0.000322359014938582;3.34956422270321e-13,0.000322771566796158;3.34956422270321e-13,0.000321499383879989;3.34956422270321e-13,0.000323473231570516;3.34956422270321e-13,0.000319589479163932;3.34956422270321e-13,0.000315532411241526;3.34956422270321e-13,0.000315194177444149;3.34956422270321e-13,0.000312424678915803;3.34956422270321e-13,0.000310889436367543;3.34956422270321e-13,0.000311997623318948;3.34956422270321e-13,0.000312763981326364;3.34956422270321e-13,0.000311988881376189;3.34956422270321e-13,0.000314393499817149;3.34956422270321e-13,0.000316128720985089;3.34956422270321e-13,0.000318999898385991;3.34956422270321e-13,0.000319367529207782;3.34956422270321e-13,0.000318723559905505;3.34956422270321e-13,0.000319680605091211;3.34956422270321e-13,0.000322479201866520;3.34956422270321e-13,0.000321962077646248;3.34956422270321e-13,0.000325148314315524;3.34956422270321e-13,0.000322988836429922;3.34956422270321e-13,0.000321615001076109;3.34956422270321e-13,0.000320056800250724;3.34956422270321e-13,0.000316436965266859;3.34956422270321e-13,0.000315633370665143;3.34956422270321e-13,0.000312946172126146;3.34956422270321e-13,0.000314089103661143;3.34956422270321e-13,0.000312041665957695;3.34956422270321e-13,0.000311361218042353;3.34956422270321e-13,0.000314285677348736;3.34956422270321e-13,0.000316210388980768;3.34956422270321e-13,0.000317739994325337;3.34956422270321e-13,0.000317394270215810;3.34956422270321e-13,0.000316915038188610;3.34956422270321e-13,0.000319505844808183;3.34956422270321e-13,0.000319557816671519;3.34956422270321e-13,0.000318227695920472;3.34956422270321e-13,0.000319811739028210;3.34956422270321e-13,0.000316550744220886;3.34956422270321e-13,0.000314503625364140;3.34956422270321e-13,0.000313340384031612;3.34956422270321e-13,0.000311338869899451;3.34956422270321e-13,0.000312277255780756;3.34956422270321e-13,0.000314128203884400;3.34956422270321e-13,0.000314937348217654;3.34956422270321e-13,0.000314293283369914;3.34956422270321e-13,0.000315916407344967;3.34956422270321e-13,0.000316820325417398;3.34956422270321e-13,0.000317854530375894;3.34956422270321e-13,0.000318620873069897;3.34956422270321e-13,0.000315786749275909;3.34956422270321e-13,0.000316680951535690;3.34956422270321e-13,0.000316839513405781;3.34956422270321e-13,0.000318150966616390;3.34956422270321e-13,0.000317932183902187;3.34956422270321e-13,0.000315756353779230;3.34956422270321e-13,0.000315380295362566;3.34956422270321e-13,0.000313559538404577;3.34956422270321e-13,0.000313523782650906;3.34956422270321e-13,0.000315445496214220;3.34956422270321e-13,0.000314909207291794;3.34956422270321e-13,0.000316668109022722;3.34956422270321e-13,0.000317584665406253;3.34956422270321e-13,0.000315462757378151;3.34956422270321e-13,0.000316520320387511;3.34956422270321e-13,0.000315727984921991;3.34956422270321e-13,0.000316088014498497;3.34956422270321e-13,0.000314658749737821;3.34956422270321e-13,0.000317705345771694;3.34956422270321e-13,0.000316104769783735;3.34956422270321e-13,0.000312701300727944;3.34956422270321e-13,0.000309986618775386;3.34956422270321e-13,0.000312214418581931;3.34956422270321e-13,0.000315786562058150;3.34956422270321e-13,0.000316166852907268;3.34956422270321e-13,0.000315492169427476;3.34956422270321e-13,0.000315892289323585;3.34956422270321e-13,0.000316032609574496;3.34956422270321e-13,0.000315221040937327;3.34956422270321e-13,0.000314882270658710;3.34956422270321e-13,0.000313930501806930;3.34956422270321e-13,0.000315175112834214;3.34956422270321e-13,0.000313722580236150;3.34956422270321e-13,0.000312370444396947;3.34956422270321e-13,0.000312138911799875;3.34956422270321e-13,0.000314017349708285;3.34956422270321e-13,0.000315347113547947;3.34956422270321e-13,0.000314050877285675;3.34956422270321e-13,0.000312779652533684;3.34956422270321e-13,0.000316856135354977;3.34956422270321e-13,0.000315128694137772;3.34956422270321e-13,0.000315624160340842;3.34956422270321e-13,0.000315849547797720;3.34956422270321e-13,0.000318432941302514;3.34956422270321e-13,0.000318769946064582;3.34956422270321e-13,0.000315494193458845;3.34956422270321e-13,0.000313205257925326;3.34956422270321e-13,0.000312657597957151;3.34956422270321e-13,0.000314354294261678;3.34956422270321e-13,0.000313771967703302;3.34956422270321e-13,0.000314557803466688;3.34956422270321e-13,0.000316136922004063;3.34956422270321e-13,0.000316384835892957;3.34956422270321e-13,0.000315635814802326;3.34956422270321e-13,0.000312361952592191;3.34956422270321e-13,0.000315552875703880;3.34956422270321e-13,0.000312259576867789;3.34956422270321e-13,0.000315776209367637;3.34956422270321e-13,0.000317368413333494;3.34956422270321e-13,0.000315116256647808;3.34956422270321e-13,0.000313308165071896;3.34956422270321e-13,0.000312023416853124;3.34956422270321e-13,0.000313884238197631;3.34956422270321e-13,0.000313228407600211;3.34956422270321e-13,0.000315171574985306;3.34956422270321e-13,0.000313137184370314;3.34956422270321e-13,0.000316017852725105;3.34956422270321e-13,0.000317350531208525;3.34956422270321e-13,0.000317937276107381;3.34956422270321e-13,0.000317226007810963;3.34956422270321e-13,0.000318693798153071;3.34956422270321e-13,0.000317018851398228];

%tr12 = [2.5,50;7.5,50;2.5,150;7.5,150]; %The 4 locations where it could be.

a1 = 1 + mods/3;
a2 = mods - mods/3;

b1 = 1 + scans/3;
b2 = scans - scans/3;

%Generate the nominal retention times using rand
    tr12o = [(mods/3 + ((mods - mods/3) - mods/3).*rand(numFac,1)), (scans/3 + ((scans-scans/3) - scans/3).*rand(numFac,1))];

for qq = 1:smpls 

    
    %pr = randperm(4);
    %tr12 = tr12(pr,:);
    %pm = [10,200; 10,200; 10,200; 10,200].*([1,1]*randn(4,2)')';
    tr1pm = (-jitter1 + (jitter1+jitter1).*rand(numFac,1));%.*randi([-1,1],numFac,1);
    tr2pm = (-jitter2 + (jitter2+jitter2).*rand(numFac,1));%.*randi([-1,1],numFac,1);
    pm = [tr1pm,tr2pm];
    
    tr12 = tr12o + pm; 
    [F(:,:,qq),D(:,:,qq),A] = gc2syn([scans,mods],tr12(:,1),repelem(peakstd1,numFac),repmat(tr12(:,2),[1,mods]),repelem(peakstd2,numFac),repelem(SNR,numFac),A);
    
    for aa = 1:numFac
        plotF(:,:,aa) = reshape(F(:,aa,qq),[scans,mods]);
        pts{aa} = plotF(:,:,aa);
    end
    
    %F(:,:,qq) = F(:,:,qq) + (max(max(max(F)))/SNR).*randn(scans*mods,numFac);
    
    sf = surfacfus(pts{:});%plotF(:,:,1),plotF(:,:,2),plotF(:,:,3));
    sfpts(:,:,:,qq) = sf;
    
    Xtemp(:,:,qq) = (F(:,:,qq)*D(:,:,qq)*A' + 6*(max(max(max(F(:,:,qq))))/SNR) + (max(max(max(F(:,:,qq))))/SNR).*randn(scans*mods,mzs))*10e4;
    Xtemp2 = reshape(Xtemp(:,:,qq),[scans,mods,mzs]);
    X(:,:,:,qq) = permute(Xtemp2,[1,3,2]);
    %X(:,:,:,qq) = X(:,:,:,qq) + (max(max(max(F)))/SNR).*randn(scans,mzs,mods);
    %X(:,:,:,qq) = X(:,:,:,qq).*10e4;
    X(X<0) = 0;
    %X(:,:,:,qq) = reshape(Xtemp(:,:,qq),[200,761,10]);
        
end



end

function [F,Dk,A] = gc2syn(dim,tr1s,tr1sig,tr2s,tr2sig,SNRs,mzs)
%Function to generate synthetic GCxGC-TOFMS Datasets. Call this function
%once per sample.

%X = rand(dim(1),dim(2),size(mzs,1));

%Generate the first dimension retention times


for ww = 1:size(mzs,2)
   
    ytr1(ww,:) = normpdf(1:1:dim(2),tr1s(ww),tr1sig(ww))';
    
for ll = 1:dim(2)
    
    ytr2(:,ll) = ytr1(ww,ll).*normpdf(1:1:dim(1),tr2s(ww,ll),tr2sig(ww));
    
end


F(:,ww) = ytr2(:);
F(:,ww) = F(:,ww)./norm(F(:,ww));
F(:,ww) = F(:,ww).*SNRs(ww);
Dk(ww,ww) = norm(F(:,ww));
%F(:,ww) = F(:,ww) + rand(size(F(:,ww),1),1); %Add noise.
%F(:,ww) = F(:,ww) + (max(max(max(F(:,ww))))/SNRs(ww)).*randn(size(F,1),1);
%F(F<0) = 0;
F(:,ww) = F(:,ww)./norm(F(:,ww));

A(:,ww) = mzs(:,ww)./norm(mzs(:,ww));

end